<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Generator - WiFi Security Educator</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/style.css">
    
    <style>
        .generator-header {
            background: linear-gradient(135deg, #7209b7 0%, #560bad 100%);
            color: white;
            padding: 2rem 0;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
        }
        
        .password-display {
            background: white;
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .password-output {
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            letter-spacing: 1px;
            padding: 1rem;
            background: #f8f9fa;
            border: 2px dashed #dee2e6;
            border-radius: var(--radius-md);
            margin: 1rem 0;
            word-break: break-all;
        }
        
        .strength-meter {
            height: 10px;
            border-radius: 5px;
            background: #e9ecef;
            margin: 1rem 0;
            overflow: hidden;
        }
        
        .strength-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease, background 0.3s ease;
        }
        
        .controls-panel {
            background: white;
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
        }
        
        .control-group {
            margin-bottom: 1.5rem;
        }
        
        .password-history {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 0.75rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
        }
        
        .password-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary);
        }
        
        .entropy-display {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            position: relative;
        }
        
        .entropy-value {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .option-card {
            background: white;
            border-radius: var(--radius-md);
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .option-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .option-card.active {
            border: 2px solid var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }
        
        .preset-badge {
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .preset-badge:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt"></i>
                <span>WiFi Security Educator</span>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/dashboard">
                            <i class="fas fa-dashboard"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/scan">
                            <i class="fas fa-wifi"></i> Scan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/analyze">
                            <i class="fas fa-search"></i> Analyze
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/generate">
                            <i class="fas fa-key"></i> Generate
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/education">
                            <i class="fas fa-graduation-cap"></i> Learn
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/settings">
                            <i class="fas fa-cog"></i> Settings
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Header -->
        <div class="generator-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-5 fw-bold">
                        <i class="fas fa-key"></i> Password Generator
                    </h1>
                    <p class="lead mb-0">
                        Create strong, secure passwords for your WiFi networks
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <span class="badge bg-light text-dark">
                        <i class="fas fa-shield-alt"></i> Secure Generation
                    </span>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Main Generator -->
            <div class="col-lg-8">
                <!-- Password Display -->
                <div class="password-display">
                    <h5 class="mb-3">Generated Password</h5>
                    <div class="password-output" id="passwordOutput">
                        Click "Generate Password" to create a secure password
                    </div>
                    
                    <div class="strength-meter">
                        <div class="strength-fill" id="strengthFill" style="width: 0%; background: #dc3545;"></div>
                    </div>
                    <div class="d-flex justify-content-between">
                        <small class="text-muted">Strength: <span id="strengthText">Very Weak</span></small>
                        <small class="text-muted" id="entropyBits">0 bits</small>
                    </div>
                    
                    <div class="mt-4">
                        <button class="btn btn-primary btn-lg me-2" onclick="generatePassword()" id="generateBtn">
                            <i class="fas fa-bolt me-2"></i>Generate Password
                        </button>
                        <button class="btn btn-outline-primary btn-lg me-2" onclick="copyPassword()" id="copyBtn">
                            <i class="fas fa-copy me-2"></i>Copy
                        </button>
                        <button class="btn btn-outline-secondary btn-lg" onclick="savePassword()">
                            <i class="fas fa-save me-2"></i>Save
                        </button>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls-panel">
                    <h5 class="mb-4">
                        <i class="fas fa-sliders-h me-2"></i>Password Settings
                    </h5>
                    
                    <!-- Length Control -->
                    <div class="control-group">
                        <label class="form-label d-flex justify-content-between">
                            <span>Password Length: <strong id="lengthValue">12</strong> characters</span>
                            <span id="lengthWarning" class="text-warning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i> Minimum 8 recommended
                            </span>
                        </label>
                        <input type="range" class="form-range" min="4" max="32" value="12" id="lengthSlider">
                        <div class="d-flex justify-content-between">
                            <small class="text-muted">4 (Weak)</small>
                            <small class="text-muted">32 (Strong)</small>
                        </div>
                    </div>
                    
                    <!-- Character Types -->
                    <div class="control-group">
                        <label class="form-label">Character Types</label>
                        <div class="row g-2">
                            <div class="col-md-6">
                                <div class="option-card" onclick="toggleOption('uppercase')" id="uppercaseCard">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="uppercaseCheck" checked>
                                        <label class="form-check-label fw-bold">
                                            <i class="fas fa-text-height me-2"></i>Uppercase (A-Z)
                                        </label>
                                        <div class="small text-muted">ABC DEF GHI</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="option-card" onclick="toggleOption('lowercase')" id="lowercaseCard">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="lowercaseCheck" checked>
                                        <label class="form-check-label fw-bold">
                                            <i class="fas fa-font me-2"></i>Lowercase (a-z)
                                        </label>
                                        <div class="small text-muted">abc def ghi</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="option-card" onclick="toggleOption('numbers')" id="numbersCard">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="numbersCheck" checked>
                                        <label class="form-check-label fw-bold">
                                            <i class="fas fa-hashtag me-2"></i>Numbers (0-9)
                                        </label>
                                        <div class="small text-muted">123 456 789</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="option-card" onclick="toggleOption('symbols')" id="symbolsCard">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="symbolsCheck" checked>
                                        <label class="form-check-label fw-bold">
                                            <i class="fas fa-asterisk me-2"></i>Symbols (!@#$)
                                        </label>
                                        <div class="small text-muted">! @ # $ % ^ & *</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Presets -->
                    <div class="control-group">
                        <label class="form-label">Quick Presets</label>
                        <div class="d-flex flex-wrap gap-2">
                            <span class="badge bg-primary preset-badge" onclick="applyPreset('wifi')">
                                <i class="fas fa-wifi me-1"></i> WiFi Password
                            </span>
                            <span class="badge bg-success preset-badge" onclick="applyPreset('strong')">
                                <i class="fas fa-shield-alt me-1"></i> Strong Password
                            </span>
                            <span class="badge bg-info preset-badge" onclick="applyPreset('memorable')">
                                <i class="fas fa-brain me-1"></i> Memorable
                            </span>
                            <span class="badge bg-warning preset-badge" onclick="applyPreset('pin')">
                                <i class="fas fa-lock me-1"></i> PIN Code
                            </span>
                            <span class="badge bg-danger preset-badge" onclick="applyPreset('random')">
                                <i class="fas fa-random me-1"></i> Maximum Random
                            </span>
                        </div>
                    </div>
                    
                    <!-- Advanced Options -->
                    <div class="control-group">
                        <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#advancedOptions">
                            <i class="fas fa-cogs me-2"></i>Advanced Options
                        </button>
                        <div class="collapse mt-3" id="advancedOptions">
                            <div class="card card-body">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Exclude Characters</label>
                                        <input type="text" class="form-control" id="excludeChars" 
                                               placeholder="e.g., 0O1lI" maxlength="20">
                                        <small class="text-muted">Characters to exclude (optional)</small>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Include Phrases</label>
                                        <input type="text" class="form-control" id="includePhrase" 
                                               placeholder="e.g., WiFi2024" maxlength="20">
                                        <small class="text-muted">Include specific text (optional)</small>
                                    </div>
                                    <div class="col-md-12">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="avoidSimilar">
                                            <label class="form-check-label">
                                                Avoid similar characters (0O, 1lI, etc.)
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="noRepeating">
                                            <label class="form-check-label">
                                                No repeating characters
                                            </label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="noSequential">
                                            <label class="form-check-label">
                                                No sequential characters (abc, 123)
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Password Info -->
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-info-circle me-2"></i>Password Information
                        </h5>
                        <div class="entropy-display mb-3">
                            <canvas id="entropyChart" width="150" height="150"></canvas>
                            <div class="entropy-value" id="entropyValue">0</div>
                        </div>
                        <div class="text-center mb-3">
                            <span class="badge bg-info" id="crackTime">Instantly</span>
                            <small class="d-block text-muted">Time to crack (est.)</small>
                        </div>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-ruler me-2 text-primary"></i>
                                Length: <span id="infoLength">12</span> characters
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-layer-group me-2 text-primary"></i>
                                Character sets: <span id="infoSets">4</span>
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-bolt me-2 text-primary"></i>
                                Entropy: <span id="infoEntropy">0</span> bits
                            </li>
                            <li>
                                <i class="fas fa-clock me-2 text-primary"></i>
                                Generated: <span id="infoTime">Just now</span>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Password History -->
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-history me-2"></i>Recent Passwords
                            </h5>
                            <button class="btn btn-sm btn-outline-secondary" onclick="clearHistory()">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        <div class="password-history" id="passwordHistory">
                            <!-- History items will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Security Tips -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-lightbulb me-2"></i>Security Tips
                        </h5>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Use at least 12 characters
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Mix uppercase, lowercase, numbers & symbols
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Avoid dictionary words
                            </li>
                            <li class="mb-2">
                                <i class="fas fa-check text-success me-2"></i>
                                Don't reuse passwords
                            </li>
                            <li>
                                <i class="fas fa-check text-success me-2"></i>
                                Use a password manager
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Password Analysis -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title mb-3">
                            <i class="fas fa-chart-bar me-2"></i>Password Analysis
                        </h5>
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <div class="display-6 fw-bold" id="analysisScore">0</div>
                                <small class="text-muted">Security Score</small>
                            </div>
                            <div class="col-md-9">
                                <div class="row">
                                    <div class="col-6 col-md-3">
                                        <small class="text-muted">Uppercase</small>
                                        <div class="fw-bold" id="countUpper">0</div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <small class="text-muted">Lowercase</small>
                                        <div class="fw-bold" id="countLower">0</div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <small class="text-muted">Numbers</small>
                                        <div class="fw-bold" id="countNumbers">0</div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <small class="text-muted">Symbols</small>
                                        <div class="fw-bold" id="countSymbols">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom JS -->
    <script src="/static/js/app.js"></script>
    
    <script>
        let currentPassword = '';
        let passwordHistory = [];
        let entropyChart = null;
        
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved history
            const savedHistory = localStorage.getItem('passwordHistory');
            if (savedHistory) {
                try {
                    passwordHistory = JSON.parse(savedHistory);
                    updatePasswordHistory();
                } catch (e) {
                    console.error('Failed to load password history:', e);
                }
            }
            
            // Initialize entropy chart
            initEntropyChart();
            
            // Set up slider
            const lengthSlider = document.getElementById('lengthSlider');
            const lengthValue = document.getElementById('lengthValue');
            
            lengthSlider.addEventListener('input', function() {
                lengthValue.textContent = this.value;
                updateLengthWarning(this.value);
            });
            
            // Set up option cards
            document.querySelectorAll('.option-card').forEach(card => {
                const checkbox = card.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', function() {
                    updateOptionCard(card, this.checked);
                    validateOptions();
                });
                updateOptionCard(card, checkbox.checked);
            });
            
            // Generate initial password
            generatePassword();
        });
        
        function initEntropyChart() {
            const ctx = document.getElementById('entropyChart').getContext('2d');
            entropyChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#4361ee', '#e9ecef'],
                        borderWidth: 0
                    }]
                },
                options: {
                    circumference: 180,
                    rotation: -90,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    }
                }
            });
        }
        
        function updateOptionCard(card, isActive) {
            if (isActive) {
                card.classList.add('active');
            } else {
                card.classList.remove('active');
            }
        }
        
        function toggleOption(type) {
            const checkbox = document.getElementById(`${type}Check`);
            checkbox.checked = !checkbox.checked;
            checkbox.dispatchEvent(new Event('change'));
        }
        
        function validateOptions() {
            const checks = [
                document.getElementById('uppercaseCheck').checked,
                document.getElementById('lowercaseCheck').checked,
                document.getElementById('numbersCheck').checked,
                document.getElementById('symbolsCheck').checked
            ];
            
            const activeCount = checks.filter(c => c).length;
            const generateBtn = document.getElementById('generateBtn');
            
            if (activeCount === 0) {
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-exclamation-triangle me-2"></i>Select Character Types';
                Utils.showNotification('Select at least one character type', 'warning');
            } else {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-bolt me-2"></i>Generate Password';
            }
            
            document.getElementById('infoSets').textContent = activeCount;
        }
        
        function updateLengthWarning(length) {
            const warning = document.getElementById('lengthWarning');
            if (length < 8) {
                warning.style.display = 'block';
            } else {
                warning.style.display = 'none';
            }
        }
        
        function generatePassword() {
            const length = parseInt(document.getElementById('lengthSlider').value);
            const includeUpper = document.getElementById('uppercaseCheck').checked;
            const includeLower = document.getElementById('lowercaseCheck').checked;
            const includeNumbers = document.getElementById('numbersCheck').checked;
            const includeSymbols = document.getElementById('symbolsCheck').checked;
            const excludeChars = document.getElementById('excludeChars').value;
            const includePhrase = document.getElementById('includePhrase').value;
            const avoidSimilar = document.getElementById('avoidSimilar').checked;
            const noRepeating = document.getElementById('noRepeating').checked;
            const noSequential = document.getElementById('noSequential').checked;
            
            // Build character set
            let charset = '';
            if (includeUpper) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLower) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) charset += '0123456789';
            if (includeSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            // Remove excluded characters
            if (excludeChars) {
                charset = charset.split('').filter(c => !excludeChars.includes(c)).join('');
            }
            
            // Remove similar characters if option enabled
            if (avoidSimilar) {
                const similar = '0O1lI';
                charset = charset.split('').filter(c => !similar.includes(c)).join('');
            }
            
            // Validate charset
            if (charset.length === 0) {
                Utils.showNotification('No characters available for generation', 'error');
                return;
            }
            
            // Generate password
            let password = '';
            const array = new Uint8Array(length);
            window.crypto.getRandomValues(array);
            
            // If include phrase, incorporate it
            if (includePhrase) {
                password = includePhrase;
                const remaining = length - includePhrase.length;
                if (remaining > 0) {
                    for (let i = 0; i < remaining; i++) {
                        password += charset[array[i] % charset.length];
                    }
                    // Shuffle to avoid phrase being at beginning
                    password = password.split('').sort(() => Math.random() - 0.5).join('');
                }
            } else {
                for (let i = 0; i < length; i++) {
                    password += charset[array[i] % charset.length];
                }
            }
            
            // Apply additional constraints
            if (noRepeating) {
                password = removeRepeatingChars(password);
            }
            
            if (noSequential) {
                password = removeSequentialChars(password);
            }
            
            // Ensure all required character types are present
            password = ensureCharacterTypes(password, includeUpper, includeLower, includeNumbers, includeSymbols);
            
            // Update display
            currentPassword = password;
            updatePasswordDisplay(password);
            analyzePassword(password);
            addToHistory(password);
            
            Utils.showNotification('New password generated!', 'success');
        }
        
        function removeRepeatingChars(password) {
            let result = '';
            let lastChar = '';
            for (const char of password) {
                if (char !== lastChar) {
                    result += char;
                    lastChar = char;
                } else {
                    // Replace with random different char
                    const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                    result += charset[Math.floor(Math.random() * charset.length)];
                }
            }
            return result;
        }
        
        function removeSequentialChars(password) {
            // Simple check for obvious sequences (abc, 123, etc.)
            const sequences = ['abc', 'bcd', 'cde', 'def', 'efg', 'fgh', 'ghi', 'hij', 'ijk', 'jkl', 'klm', 'lmn', 'mno', 'nop', 'opq', 'pqr', 'qrs', 'rst', 'stu', 'tuv', 'uvw', 'vwx', 'wxy', 'xyz',
                              '012', '123', '234', '345', '456', '567', '678', '789'];
            
            let result = password;
            sequences.forEach(seq => {
                if (result.toLowerCase().includes(seq)) {
                    // Replace sequence with random chars
                    const index = result.toLowerCase().indexOf(seq);
                    const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
                    for (let i = 0; i < seq.length; i++) {
                        result = result.substring(0, index + i) + charset[Math.floor(Math.random() * charset.length)] + result.substring(index + i + 1);
                    }
                }
            });
            
            return result;
        }
        
        function ensureCharacterTypes(password, needUpper, needLower, needNumbers, needSymbols) {
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumbers = /\d/.test(password);
            const hasSymbols = /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password);
            
            let result = password;
            const charset = {
                upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
                lower: 'abcdefghijklmnopqrstuvwxyz',
                numbers: '0123456789',
                symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
            };
            
            // Replace random positions with missing types
            if (needUpper && !hasUpper) {
                const pos = Math.floor(Math.random() * result.length);
                result = result.substring(0, pos) + charset.upper[Math.floor(Math.random() * charset.upper.length)] + result.substring(pos + 1);
            }
            
            if (needLower && !hasLower) {
                const pos = Math.floor(Math.random() * result.length);
                result = result.substring(0, pos) + charset.lower[Math.floor(Math.random() * charset.lower.length)] + result.substring(pos + 1);
            }
            
            if (needNumbers && !hasNumbers) {
                const pos = Math.floor(Math.random() * result.length);
                result = result.substring(0, pos) + charset.numbers[Math.floor(Math.random() * charset.numbers.length)] + result.substring(pos + 1);
            }
            
            if (needSymbols && !hasSymbols) {
                const pos = Math.floor(Math.random() * result.length);
                result = result.substring(0, pos) + charset.symbols[Math.floor(Math.random() * charset.symbols.length)] + result.substring(pos + 1);
            }
            
            return result;
        }
        
        function updatePasswordDisplay(password) {
            document.getElementById('passwordOutput').textContent = password;
            document.getElementById('infoLength').textContent = password.length;
            document.getElementById('infoTime').textContent = 'Just now';
        }
        
        function analyzePassword(password) {
            // Count character types
            const upper = (password.match(/[A-Z]/g) || []).length;
            const lower = (password.match(/[a-z]/g) || []).length;
            const numbers = (password.match(/\d/g) || []).length;
            const symbols = (password.match(/[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/g) || []).length;
            
            document.getElementById('countUpper').textContent = upper;
            document.getElementById('countLower').textContent = lower;
            document.getElementById('countNumbers').textContent = numbers;
            document.getElementById('countSymbols').textContent = symbols;
            
            // Calculate entropy
            const charsetSize = (upper > 0 ? 26 : 0) + (lower > 0 ? 26 : 0) + (numbers > 0 ? 10 : 0) + (symbols > 0 ? 32 : 0);
            const entropy = charsetSize > 0 ? Math.log2(Math.pow(charsetSize, password.length)) : 0;
            
            // Update entropy display
            document.getElementById('entropyBits').textContent = Math.round(entropy) + ' bits';
            document.getElementById('infoEntropy').textContent = Math.round(entropy);
            document.getElementById('entropyValue').textContent = Math.round(entropy);
            
            // Update entropy chart
            if (entropyChart) {
                const maxEntropy = 128; // Maximum reasonable entropy
                const entropyPercent = Math.min((entropy / maxEntropy) * 100, 100);
                entropyChart.data.datasets[0].data = [entropyPercent, 100 - entropyPercent];
                entropyChart.update();
            }
            
            // Calculate strength score (0-100)
            let score = 0;
            
            // Length factor (max 40 points)
            score += Math.min(password.length * 3, 40);
            
            // Character variety factor (max 30 points)
            const types = [upper > 0, lower > 0, numbers > 0, symbols > 0].filter(Boolean).length;
            score += types * 7.5;
            
            // Entropy factor (max 30 points)
            score += Math.min(entropy / 4, 30);
            
            // Update strength meter
            const strengthFill = document.getElementById('strengthFill');
            const strengthText = document.getElementById('strengthText');
            
            strengthFill.style.width = score + '%';
            
            if (score >= 80) {
                strengthFill.style.background = '#198754';
                strengthText.textContent = 'Very Strong';
                strengthText.className = 'text-success';
            } else if (score >= 60) {
                strengthFill.style.background = '#20c997';
                strengthText.textContent = 'Strong';
                strengthText.className = 'text-info';
            } else if (score >= 40) {
                strengthFill.style.background = '#ffc107';
                strengthText.textContent = 'Moderate';
                strengthText.className = 'text-warning';
            } else if (score >= 20) {
                strengthFill.style.background = '#fd7e14';
                strengthText.textContent = 'Weak';
                strengthText.className = 'text-warning';
            } else {
                strengthFill.style.background = '#dc3545';
                strengthText.textContent = 'Very Weak';
                strengthText.className = 'text-danger';
            }
            
            // Update analysis score
            document.getElementById('analysisScore').textContent = Math.round(score);
            
            // Estimate crack time
            const crackTime = estimateCrackTime(entropy);
            document.getElementById('crackTime').textContent = crackTime;
        }
        
        function estimateCrackTime(entropy) {
            // Very rough estimation
            const guessesPerSecond = 1000000000; // 1 billion guesses/sec (modern GPU)
            const seconds = Math.pow(2, entropy) / guessesPerSecond;
            
            if (seconds < 1) return 'Instantly';
            if (seconds < 60) return '< 1 minute';
            if (seconds < 3600) return Math.round(seconds / 60) + ' minutes';
            if (seconds < 86400) return Math.round(seconds / 3600) + ' hours';
            if (seconds < 31536000) return Math.round(seconds / 86400) + ' days';
            if (seconds < 3153600000) return Math.round(seconds / 31536000) + ' years';
            return Math.round(seconds / 3153600000) + ' centuries';
        }
        
        function addToHistory(password) {
            const timestamp = new Date().toLocaleString();
            const item = {
                password: password,
                timestamp: timestamp,
                strength: document.getElementById('strengthText').textContent
            };
            
            passwordHistory.unshift(item);
            if (passwordHistory.length > 10) {
                passwordHistory = passwordHistory.slice(0, 10);
            }
            
            updatePasswordHistory();
            localStorage.setItem('passwordHistory', JSON.stringify(passwordHistory));
        }
        
        function updatePasswordHistory() {
            const container = document.getElementById('passwordHistory');
            let html = '';
            
            if (passwordHistory.length === 0) {
                html = '<div class="text-center py-3 text-muted">No password history</div>';
            } else {
                passwordHistory.forEach((item, index) => {
                    const strengthColor = item.strength.includes('Strong') ? 'success' :
                                         item.strength.includes('Moderate') ? 'warning' :
                                         item.strength.includes('Weak') ? 'danger' : 'secondary';
                    
                    html += `
                        <div class="history-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">${item.timestamp}</small>
                                    <div class="small font-monospace">${maskPassword(item.password)}</div>
                                </div>
                                <div>
                                    <span class="badge bg-${strengthColor}">${item.strength}</span>
                                    <button class="btn btn-sm btn-link" onclick="useFromHistory(${index})">
                                        <i class="fas fa-redo"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }
        
        function maskPassword(password) {
            if (password.length <= 4) {
                return '•'.repeat(password.length);
            }
            return password.substring(0, 2) + '•'.repeat(password.length - 4) + password.substring(password.length - 2);
        }
        
        function useFromHistory(index) {
            if (index >= 0 && index < passwordHistory.length) {
                currentPassword = passwordHistory[index].password;
                updatePasswordDisplay(currentPassword);
                analyzePassword(currentPassword);
                Utils.showNotification('Password loaded from history', 'info');
            }
        }
        
        function clearHistory() {
            if (confirm('Clear all password history?')) {
                passwordHistory = [];
                updatePasswordHistory();
                localStorage.removeItem('passwordHistory');
                Utils.showNotification('History cleared', 'warning');
            }
        }
        
        function copyPassword() {
            if (!currentPassword) {
                Utils.showNotification('No password to copy', 'warning');
                return;
            }
            
            navigator.clipboard.writeText(currentPassword)
                .then(() => {
                    const copyBtn = document.getElementById('copyBtn');
                    const originalHtml = copyBtn.innerHTML;
                    
                    copyBtn.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
                    copyBtn.classList.remove('btn-outline-primary');
                    copyBtn.classList.add('btn-success');
                    
                    setTimeout(() => {
                        copyBtn.innerHTML = originalHtml;
                        copyBtn.classList.remove('btn-success');
                        copyBtn.classList.add('btn-outline-primary');
                    }, 2000);
                    
                    Utils.showNotification('Password copied to clipboard', 'success');
                })
                .catch(err => {
                    Utils.showNotification('Failed to copy password', 'error');
                });
        }
        
        function savePassword() {
            if (!currentPassword) {
                Utils.showNotification('No password to save', 'warning');
                return;
            }
            
            // In a real app, this would save to a secure storage or password manager
            Utils.showNotification('Password saved (simulated)', 'info');
        }
        
        function applyPreset(preset) {
            const lengthSlider = document.getElementById('lengthSlider');
            const uppercaseCheck = document.getElementById('uppercaseCheck');
            const lowercaseCheck = document.getElementById('lowercaseCheck');
            const numbersCheck = document.getElementById('numbersCheck');
            const symbolsCheck = document.getElementById('symbolsCheck');
            
            switch(preset) {
                case 'wifi':
                    lengthSlider.value = 12;
                    uppercaseCheck.checked = true;
                    lowercaseCheck.checked = true;
                    numbersCheck.checked = true;
                    symbolsCheck.checked = false;
                    break;
                    
                case 'strong':
                    lengthSlider.value = 16;
                    uppercaseCheck.checked = true;
                    lowercaseCheck.checked = true;
                    numbersCheck.checked = true;
                    symbolsCheck.checked = true;
                    break;
                    
                case 'memorable':
                    lengthSlider.value = 20;
                    uppercaseCheck.checked = true;
                    lowercaseCheck.checked = true;
                    numbersCheck.checked = true;
                    symbolsCheck.checked = false;
                    break;
                    
                case 'pin':
                    lengthSlider.value = 6;
                    uppercaseCheck.checked = false;
                    lowercaseCheck.checked = false;
                    numbersCheck.checked = true;
                    symbolsCheck.checked = false;
                    break;
                    
                case 'random':
                    lengthSlider.value = 24;
                    uppercaseCheck.checked = true;
                    lowercaseCheck.checked = true;
                    numbersCheck.checked = true;
                    symbolsCheck.checked = true;
                    break;
            }
            
            // Update UI
            document.getElementById('lengthValue').textContent = lengthSlider.value;
            updateLengthWarning(lengthSlider.value);
            
            // Update option cards
            document.querySelectorAll('.option-card').forEach(card => {
                const checkbox = card.querySelector('input[type="checkbox"]');
                updateOptionCard(card, checkbox.checked);
            });
            
            validateOptions();
            
            // Generate new password with preset
            generatePassword();
            
            Utils.showNotification(`Applied ${preset} preset`, 'info');
        }
    </script>
</body>
</html>